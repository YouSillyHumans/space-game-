<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Space Survivor Arcade</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#08040f;font-family:'Courier New',monospace;touch-action:none;-webkit-tap-highlight-color:transparent;user-select:none;-webkit-user-select:none}
canvas{display:block;position:absolute;top:0;left:0}
#ui{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10;pointer-events:auto}
#ui.hidden{display:none!important}
.title-text{font-size:clamp(24px,7vw,48px);font-weight:bold;color:#00eeff;text-shadow:0 0 20px #00aaff66;letter-spacing:4px;margin-bottom:4px}
.sub-text{color:#556;font-size:11px;letter-spacing:6px;margin-bottom:40px}
.score-text{color:#fff;font-size:42px;font-weight:bold;margin-bottom:8px}
.wave-text{color:#667;font-size:14px;margin-bottom:8px}
.highscore-text{color:#ffdd00;font-size:14px;margin-bottom:16px}
.gameover-text{color:#ff4466;font-size:12px;letter-spacing:6px;margin-bottom:16px}
.new-hs{color:#ffdd00;font-size:14px;letter-spacing:3px;margin-bottom:20px}
.btn{border:2px solid #00ccff;color:#00ccff;background:transparent;padding:16px 52px;font-size:18px;font-family:'Courier New',monospace;letter-spacing:5px;cursor:pointer;margin-top:20px;transition:background 0.2s}
.btn:hover{background:rgba(0,200,255,0.1)}
.btn.red{border-color:#ff4466;color:#ff4466}
.btn.red:hover{background:rgba(255,68,102,0.1)}
.info{margin-top:40px;color:#445;font-size:11px;text-align:center;line-height:2.4}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="ui">
  <div class="title-text">SPACE SURVIVOR</div>
  <div class="sub-text">ARCADE SHOOTER</div>
  <div id="hs-display" class="highscore-text" style="display:none"></div>
  <button class="btn" id="startBtn">START</button>
  <div class="info">
    <div>TOUCH OR CLICK & DRAG TO MOVE</div>
    <div>AUTO-FIRE WHILE HOLDING</div>
    <div>COLLECT POWERUPS • CHAIN COMBOS</div>
  </div>
</div>

<div id="goUI" style="position:absolute;top:0;left:0;width:100%;height:100%;display:none;flex-direction:column;align-items:center;justify-content:center;z-index:10">
  <div class="gameover-text">G A M E &nbsp; O V E R</div>
  <div class="score-text" id="goScore">0</div>
  <div class="wave-text" id="goWave">WAVE 0</div>
  <div class="new-hs" id="goNewHS" style="display:none">★ NEW HIGH SCORE ★</div>
  <button class="btn red" id="retryBtn">RETRY</button>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const ui = document.getElementById('ui');
const goUI = document.getElementById('goUI');

let W, H;
function resize() {
  const dpr = window.devicePixelRatio || 1;
  W = window.innerWidth;
  H = window.innerHeight;
  canvas.width = W * dpr;
  canvas.height = H * dpr;
  canvas.style.width = W + 'px';
  canvas.style.height = H + 'px';
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}
resize();
window.addEventListener('resize', resize);

let highScore = 0;
let g = null;
let playing = false;
const touch = { active: false, x: 0, y: 0 };

const ET = {
  drone:   { hp:1, speed:1.8, size:14, score:100, color:'#ff4466', sr:0 },
  fighter: { hp:2, speed:1.3, size:18, score:200, color:'#ff8800', sr:0.008 },
  tank:    { hp:5, speed:0.7, size:24, score:500, color:'#aa44ff', sr:0.012 },
  boss:    { hp:30,speed:0.3, size:44, score:3000,color:'#ff0055', sr:0.022 },
};
const PT = {
  rapidfire:{ color:'#ffdd00', label:'R', dur:300 },
  spread:   { color:'#00ddff', label:'S', dur:400 },
  shield:   { color:'#44ff88', label:'D', dur:500 },
  nuke:     { color:'#ff4444', label:'N', dur:0 },
};

function init() {
  g = {
    p:{ x:W/2, y:H-100, sz:16, lives:3, inv:0, cd:0, rate:10, combo:0, ct:0, pu:{} },
    bul:[], eb:[], en:[], pt:[], pu:[], tx:[],
    stars: Array.from({length:70},()=>({ x:Math.random()*W, y:Math.random()*H, s:0.3+Math.random()*1.5, sz:0.5+Math.random()*1.5, a:0.2+Math.random()*0.7 })),
    sc:0, wave:0, wt:80, t:0, boss:false, shake:0, flash:0
  };
  spawnWave();
}

function pts(x,y,n,c,sp,l){ sp=sp||3; l=l||30; for(let i=0;i<n&&g.pt.length<120;i++){const a=Math.random()*Math.PI*2,s=(0.5+Math.random())*sp; g.pt.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:l,ml:l,c,sz:2+Math.random()*4});}}
function ftx(x,y,t,c){ g.tx.push({x,y,t,c:c||'#fff',life:50,vy:-1.8}); }

function spawnWave(){
  g.wave++; g.wt=140;
  if(g.wave%5===0){
    const hp=25+g.wave*4;
    g.en.push({tp:'boss',...ET.boss,hp,mhp:hp,x:W/2,y:-60,ty:80,vx:0.6,del:0,sr:ET.boss.sr});
    g.boss=true;
  } else {
    const cnt=Math.min(3+g.wave*2,22);
    for(let i=0;i<cnt;i++){
      const ts=['drone']; if(g.wave>=2)ts.push('drone','fighter'); if(g.wave>=4)ts.push('fighter','tank');
      const tp=ts[Math.floor(Math.random()*ts.length)], t=ET[tp];
      g.en.push({tp,...t,mhp:t.hp,x:30+Math.random()*(W-60),y:-20-i*35-Math.random()*40,ty:30+Math.random()*(H*0.3),vx:(Math.random()-0.5)*2,del:i*6,sr:t.sr});
    }
  }
}

function shoot(){
  const p=g.p; if(p.cd>0)return;
  p.cd=p.pu.rapidfire>0?4:p.rate;
  g.bul.push({x:p.x,y:p.y-p.sz-4,vx:0,vy:-10});
  if(p.pu.spread>0){
    g.bul.push({x:p.x-7,y:p.y-p.sz,vx:-2,vy:-9.5});
    g.bul.push({x:p.x+7,y:p.y-p.sz,vx:2,vy:-9.5});
    g.bul.push({x:p.x-3,y:p.y-p.sz-2,vx:-0.8,vy:-10});
    g.bul.push({x:p.x+3,y:p.y-p.sz-2,vx:0.8,vy:-10});
  }
}

function update(){
  g.t++;
  const p=g.p;
  g.stars.forEach(s=>{s.y+=s.s;if(s.y>H){s.y=0;s.x=Math.random()*W;}});
  if(touch.active){
    const dx=touch.x-p.x,dy=touch.y-(p.y-50),d=Math.hypot(dx,dy);
    if(d>3){const s=Math.min(d*0.15,7);p.x+=(dx/d)*s;p.y+=(dy/d)*s;}
    shoot();
  }
  p.x=Math.max(p.sz,Math.min(W-p.sz,p.x));
  p.y=Math.max(p.sz+55,Math.min(H-p.sz,p.y));
  if(p.cd>0)p.cd--;if(p.inv>0)p.inv--;
  if(p.ct>0)p.ct--;else p.combo=0;
  for(const k in p.pu)if(p.pu[k]>0)p.pu[k]--;
  if(g.wt>0)g.wt--;else if(g.en.length===0)spawnWave();
  g.bul=g.bul.filter(b=>{b.x+=b.vx;b.y+=b.vy;return b.y>-10&&b.x>-10&&b.x<W+10;});
  g.eb=g.eb.filter(b=>{b.x+=b.vx;b.y+=b.vy;return b.y<H+10&&b.y>-10;});
  g.en=g.en.filter(e=>{
    if(e.del>0){e.del--;return true;}
    if(e.y<e.ty)e.y+=e.speed*1.5;
    else{e.x+=e.vx;if(e.x<e.size||e.x>W-e.size)e.vx*=-1;e.y+=Math.sin(g.t*0.025+e.x*0.01)*0.4;}
    if(e.y>=e.ty&&e.sr>0&&Math.random()<e.sr){const a=Math.atan2(p.y-e.y,p.x-e.x);g.eb.push({x:e.x,y:e.y+e.size,vx:Math.cos(a)*3.5,vy:Math.sin(a)*3.5});}
    for(let i=g.bul.length-1;i>=0;i--){const b=g.bul[i];if(Math.hypot(b.x-e.x,b.y-e.y)<e.size+5){g.bul.splice(i,1);e.hp--;pts(b.x,b.y,3,e.color,2,12);if(e.hp<=0){p.combo++;p.ct=80;const m=Math.min(p.combo,10),s=e.score*m;g.sc+=s;ftx(e.x,e.y,m>1?s+' x'+m:''+s,m>1?'#ffdd00':'#fff');pts(e.x,e.y,14+e.size/2,e.color,4,35);g.shake=Math.min(e.size*0.3,8);if(Math.random()<0.28){const ks=Object.keys(PT),k=ks[Math.floor(Math.random()*ks.length)];g.pu.push({x:e.x,y:e.y,tp:k,...PT[k],vy:1,tm:0});}if(e.tp==='boss')g.boss=false;return false;}break;}}
    if(p.inv<=0&&!(p.pu.shield>0)&&Math.hypot(p.x-e.x,p.y-e.y)<e.size+p.sz){p.lives--;p.inv=90;g.shake=10;g.flash=8;pts(p.x,p.y,15,'#00ccff',4,30);}
    return e.y<=H+50;
  });
  if(p.inv<=0){g.eb=g.eb.filter(b=>{if(Math.hypot(b.x-p.x,b.y-p.y)<p.sz+5){if(p.pu.shield>0){pts(b.x,b.y,4,'#44ff88',2,12);return false;}p.lives--;p.inv=90;g.shake=8;g.flash=6;pts(p.x,p.y,10,'#00ccff',3,25);return false;}return true;});}
  g.pu=g.pu.filter(pw=>{pw.y+=pw.vy;pw.tm++;if(Math.hypot(pw.x-p.x,pw.y-p.y)<p.sz+16){if(pw.tp==='nuke'){g.en.forEach(en=>{g.sc+=en.score;pts(en.x,en.y,10,en.color,4,30);});g.en=[];g.eb=[];g.flash=12;g.shake=14;ftx(p.x,p.y-30,'NUKE!','#ff4444');}else{p.pu[pw.tp]=(p.pu[pw.tp]||0)+pw.dur;const lb={rapidfire:'RAPID FIRE!',spread:'SPREAD!',shield:'SHIELD!'};ftx(p.x,p.y-30,lb[pw.tp],pw.color);}pts(pw.x,pw.y,8,pw.color,3,20);return false;}return pw.y<H+20;});
  g.pt=g.pt.filter(p=>{p.x+=p.vx;p.y+=p.vy;p.vx*=0.96;p.vy*=0.96;p.life--;return p.life>0;});
  g.tx=g.tx.filter(f=>{f.y+=f.vy;f.life--;return f.life>0;});
  if(g.shake>0)g.shake*=0.88;if(g.flash>0)g.flash--;
  if(p.lives<=0)return'dead';return'ok';
}

function drawShip(cx,cy,sz,col,str,rot){
  ctx.save();ctx.translate(cx,cy);if(rot)ctx.rotate(Math.PI);
  ctx.fillStyle=col;ctx.beginPath();ctx.moveTo(0,-sz);ctx.lineTo(-sz*0.75,sz*0.6);ctx.lineTo(-sz*0.25,sz*0.3);ctx.lineTo(0,sz*0.5);ctx.lineTo(sz*0.25,sz*0.3);ctx.lineTo(sz*0.75,sz*0.6);ctx.closePath();ctx.fill();
  if(str){ctx.strokeStyle=str;ctx.lineWidth=1;ctx.stroke();}ctx.restore();
}

function draw(){
  const bg=ctx.createLinearGradient(0,0,0,H);bg.addColorStop(0,'#08040f');bg.addColorStop(0.5,'#0c0818');bg.addColorStop(1,'#0a0612');ctx.fillStyle=bg;ctx.fillRect(0,0,W,H);
  if(!g||!playing){
    // Just draw stars on menu screens
    if(g) g.stars.forEach(s=>{ctx.globalAlpha=s.a;ctx.fillStyle='#fff';ctx.fillRect(s.x,s.y,s.sz,s.sz);});
    ctx.globalAlpha=1;
    return;
  }
  const sx=g.shake>0.5?(Math.random()-0.5)*g.shake:0,sy=g.shake>0.5?(Math.random()-0.5)*g.shake:0;
  ctx.save();ctx.translate(sx,sy);
  if(g.flash>0){ctx.globalAlpha=g.flash*0.05;ctx.fillStyle='#fff';ctx.fillRect(0,0,W,H);ctx.globalAlpha=1;}
  g.stars.forEach(s=>{ctx.globalAlpha=s.a*(0.7+Math.sin(g.t*0.05+s.x)*0.3);ctx.fillStyle='#fff';ctx.fillRect(s.x,s.y,s.sz,s.sz);});ctx.globalAlpha=1;
  // Powerup pickups
  g.pu.forEach(pw=>{ctx.save();ctx.translate(pw.x,pw.y);ctx.globalAlpha=0.3;ctx.fillStyle=pw.color;ctx.beginPath();ctx.arc(0,0,16+Math.sin(pw.tm*0.1)*3,0,Math.PI*2);ctx.fill();ctx.globalAlpha=1;ctx.strokeStyle=pw.color;ctx.lineWidth=2;ctx.beginPath();ctx.arc(0,0,12,0,Math.PI*2);ctx.stroke();ctx.fillStyle='#fff';ctx.font='bold 12px monospace';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(pw.label,0,1);ctx.restore();});
  // Enemy bullets
  g.eb.forEach(b=>{ctx.fillStyle='#ff6644';ctx.beginPath();ctx.arc(b.x,b.y,4,0,Math.PI*2);ctx.fill();ctx.globalAlpha=0.3;ctx.beginPath();ctx.arc(b.x,b.y,8,0,Math.PI*2);ctx.fill();ctx.globalAlpha=1;});
  // Player bullets
  g.bul.forEach(b=>{const gr=ctx.createLinearGradient(b.x,b.y-7,b.x,b.y+7);gr.addColorStop(0,'#00ffff');gr.addColorStop(1,'#0066ff');ctx.fillStyle=gr;ctx.fillRect(b.x-1.5,b.y-7,3,14);ctx.globalAlpha=0.4;ctx.fillStyle='#00ccff';ctx.fillRect(b.x-3,b.y-9,6,18);ctx.globalAlpha=1;});
  // Enemies
  g.en.forEach(e=>{if(e.del>0)return;ctx.globalAlpha=0.15;ctx.fillStyle=e.color;ctx.beginPath();ctx.arc(e.x,e.y,e.size*1.5,0,Math.PI*2);ctx.fill();ctx.globalAlpha=1;drawShip(e.x,e.y,e.size,e.color,'rgba(255,255,255,0.25)',true);if(e.tp==='boss'){const pct=e.hp/e.mhp;ctx.fillStyle='#333';ctx.fillRect(e.x-30,e.y-e.size-12,60,6);ctx.fillStyle=pct>0.5?'#44ff88':pct>0.25?'#ffaa00':'#ff2244';ctx.fillRect(e.x-30,e.y-e.size-12,60*pct,6);}else if(e.hp>1){ctx.fillStyle='#fff';ctx.font='bold 9px monospace';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(e.hp,e.x,e.y+2);}});
  // Player
  const p=g.p;
  if(p.inv<=0||Math.floor(p.inv/4)%2===0){
    if(p.pu.shield>0){ctx.globalAlpha=0.2+Math.sin(g.t*0.1)*0.1;ctx.strokeStyle='#44ff88';ctx.lineWidth=2;ctx.beginPath();ctx.arc(p.x,p.y,p.sz+12,0,Math.PI*2);ctx.stroke();ctx.globalAlpha=1;}
    ctx.globalAlpha=0.5+Math.sin(g.t*0.3)*0.3;const eg=ctx.createRadialGradient(p.x,p.y+p.sz+4,0,p.x,p.y+p.sz+4,14);eg.addColorStop(0,'#00aaff');eg.addColorStop(1,'transparent');ctx.fillStyle=eg;ctx.fillRect(p.x-8,p.y+p.sz-2,16,18);ctx.globalAlpha=1;
    drawShip(p.x,p.y,p.sz,'#00ccff','#66eeff',false);
    ctx.fillStyle='#aaeeff';ctx.beginPath();ctx.arc(p.x,p.y-2,4,0,Math.PI*2);ctx.fill();
  }
  // Particles
  g.pt.forEach(p=>{ctx.globalAlpha=p.life/p.ml;ctx.fillStyle=p.c;ctx.fillRect(p.x-p.sz/2,p.y-p.sz/2,p.sz,p.sz);});ctx.globalAlpha=1;
  // Float text
  g.tx.forEach(f=>{ctx.globalAlpha=f.life/50;ctx.fillStyle=f.c;ctx.font='bold 15px monospace';ctx.textAlign='center';ctx.fillText(f.t,f.x,f.y);});ctx.globalAlpha=1;
  // HUD
  ctx.fillStyle='#fff';ctx.font='bold 20px monospace';ctx.textAlign='left';ctx.fillText(g.sc.toLocaleString(),14,34);
  ctx.font='12px monospace';ctx.fillStyle='#778';ctx.fillText('WAVE '+g.wave,14,52);
  if(p.combo>1){ctx.fillStyle='#ffdd00';ctx.font='bold 14px monospace';ctx.textAlign='right';ctx.fillText('x'+p.combo+' COMBO',W-14,52);}
  ctx.textAlign='right';for(let i=0;i<p.lives;i++){const lx=W-20-i*24;ctx.fillStyle='#00ccff';ctx.beginPath();ctx.moveTo(lx,20);ctx.lineTo(lx-8,32);ctx.lineTo(lx,27);ctx.lineTo(lx+8,32);ctx.closePath();ctx.fill();}
  let py=60;for(const k in p.pu){if(p.pu[k]>0){const pw=PT[k];ctx.fillStyle='rgba(0,0,0,0.4)';ctx.fillRect(12,py,80,10);ctx.fillStyle=pw.color;ctx.fillRect(12,py,80*(p.pu[k]/pw.dur),10);ctx.fillStyle='#fff';ctx.font='8px monospace';ctx.textAlign='left';ctx.fillText(k.toUpperCase(),16,py+8);py+=14;}}
  if(g.wt>80){ctx.globalAlpha=Math.min(1,(g.wt-80)/40);ctx.fillStyle='#fff';ctx.font='bold 28px monospace';ctx.textAlign='center';ctx.fillText(g.boss?'!! BOSS WAVE !!':'WAVE '+g.wave,W/2,H/2-20);ctx.globalAlpha=1;}
  ctx.restore();
}

// Input
function getPos(e){
  const r=canvas.getBoundingClientRect();
  let cx,cy;
  if(e.touches&&e.touches.length>0){cx=e.touches[0].clientX;cy=e.touches[0].clientY;}
  else if(e.changedTouches&&e.changedTouches.length>0){cx=e.changedTouches[0].clientX;cy=e.changedTouches[0].clientY;}
  else{cx=e.clientX;cy=e.clientY;}
  return{x:cx-r.left,y:cy-r.top};
}

canvas.addEventListener('touchstart',e=>{e.preventDefault();if(!playing)return;const p=getPos(e);touch.active=true;touch.x=p.x;touch.y=p.y;},{passive:false});
canvas.addEventListener('touchmove',e=>{e.preventDefault();if(!touch.active)return;const p=getPos(e);touch.x=p.x;touch.y=p.y;},{passive:false});
canvas.addEventListener('touchend',e=>{e.preventDefault();touch.active=false;},{passive:false});
canvas.addEventListener('touchcancel',()=>{touch.active=false;});
canvas.addEventListener('mousedown',e=>{if(!playing)return;const p=getPos(e);touch.active=true;touch.x=p.x;touch.y=p.y;});
canvas.addEventListener('mousemove',e=>{if(!touch.active)return;const p=getPos(e);touch.x=p.x;touch.y=p.y;});
canvas.addEventListener('mouseup',()=>{touch.active=false;});
canvas.addEventListener('mouseleave',()=>{touch.active=false;});

// Buttons
function startGame(){
  init();
  playing=true;
  ui.style.display='none';
  ui.classList.add('hidden');
  goUI.style.display='none';
}
function gameOver(){
  playing=false;
  touch.active=false;
  const isNew=g.sc>highScore;
  if(isNew)highScore=g.sc;
  document.getElementById('goScore').textContent=g.sc.toLocaleString();
  document.getElementById('goWave').textContent='WAVE '+g.wave;
  document.getElementById('goNewHS').style.display=isNew&&g.sc>0?'block':'none';
  ui.style.display='none';
  goUI.style.display='flex';
  if(highScore>0){
    document.getElementById('hs-display').style.display='block';
    document.getElementById('hs-display').textContent='HIGH SCORE: '+highScore.toLocaleString();
  }
}

document.getElementById('startBtn').addEventListener('click',startGame);
document.getElementById('startBtn').addEventListener('touchend',e=>{e.preventDefault();startGame();});
document.getElementById('retryBtn').addEventListener('click',startGame);
document.getElementById('retryBtn').addEventListener('touchend',e=>{e.preventDefault();startGame();});

// Loop
function loop(){
  if(playing&&g){
    const s=update();
    if(s==='dead')gameOver();
  }
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>

</body>
</html>
